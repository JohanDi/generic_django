{% extends "base.html" %}
{% load custom_template_tags %}

{% load tz %}

{% block title %}{{ verbose_name_plural|capfirst }}{% endblock %}

{% block content %}

<!--Title section-->
<div class="d-flex justify-content-between flex-wrap flex-md-nowrap align-items-center pt-3 pb-2 mb-3 border-bottom">
    <h2 class="text-primary">{{ verbose_name_plural|capfirst }}</h2>
    <div class="btn-toolbar mb-2 mb-md-0">
      <div class="btn-group me-2">
        <a href="{% url create_url %}" class="btn btn-sm btn-outline-secondary">
            <i class="fas fa-plus"></i> Add {{ verbose_name|capfirst }}
        </a>
      </div>
    </div>
</div>
<!--Table-->
<table class="table table-striped">
    <thead>
        <tr>
            {% for header in headers %}
                <th>
                  {% with current_order=request.GET.order_by %}
                  {% if current_order == header.field %}
                    <a class="text-primary" href="?order_by=-{{ header.field }}">{{ header.name }} &#9650;</a>
                  {% elif current_order == "-"|add:header.field %}
                    <a class="text-primary" href="?order_by={{ header.field }}">{{ header.name }} &#9660;</a>
                  {% else %}
                    <a class="text-primary" href="?order_by={{ header.field }}">{{ header.name }}</a>
                  {% endif %}
                  {% endwith %}
                </th>
            {% endfor %}
        </tr>
    </thead>
    <tbody>
        {% for object in object_list %}
        <tr>
            {% for header in headers %}
              {% if forloop.first %}
                <td>
                  <a href="{% url update_url object.pk %}" class="row-link">
                    {{ object|get_item:header.field }}
                  </a>
                </td>
              {% else %}
                <td>{{ object|get_item:header.field }}</td>
              {% endif %}
            {% endfor %}
                <td class="text-end">
                  <!-- Edit/Delete links as before -->
                </td>
            <td class="text-end">
              <a href="{% url update_url object.pk %}" class="edit-link">
                <i class="fa fa-pencil"></i>
              </a>
                <a href="#" class="ms-2 delete-link"
                   data-bs-toggle="modal"
                   data-bs-target="#confirmDeleteModal"
                   data-delete-url="{% url delete_url object.pk %}">
                  <i class="fa fa-times"></i>
                </a>
            </td>
        </tr>
        {% empty %}
        <tr>
            <td colspan="6">No sections found.</td>
        </tr>
        {% endfor %}
    </tbody>
</table>
<!--Pagination-->
<div class="d-flex justify-content-center my-4">
  <nav aria-label="Page navigation">
    <ul class="pagination">
      {% if page_obj.has_previous %}
        <li class="page-item">
          <a class="page-link" href="?page=1">&laquo; first</a>
        </li>
        <li class="page-item">
          <a class="page-link" href="?page={{ page_obj.previous_page_number }}">previous</a>
        </li>
      {% else %}
        <li class="page-item disabled">
          <span class="page-link">&laquo; first</span>
        </li>
        <li class="page-item disabled">
          <span class="page-link">previous</span>
        </li>
      {% endif %}

      <li class="page-item active">
        <span class="page-link">
          Page {{ page_obj.number }} of {{ page_obj.paginator.num_pages }}
        </span>
      </li>

      {% if page_obj.has_next %}
        <li class="page-item">
          <a class="page-link" href="?page={{ page_obj.next_page_number }}">next</a>
        </li>
        <li class="page-item">
          <a class="page-link" href="?page={{ page_obj.paginator.num_pages }}">last &raquo;</a>
        </li>
      {% else %}
        <li class="page-item disabled">
          <span class="page-link">next</span>
        </li>
        <li class="page-item disabled">
          <span class="page-link">last &raquo;</span>
        </li>
      {% endif %}
    </ul>
  </nav>
</div>
<!-- Delete Modal -->
<div class="modal fade" id="confirmDeleteModal" tabindex="-1" aria-labelledby="confirmDeleteLabel" aria-hidden="true">
  <div class="modal-dialog">
    <div class="modal-content">
      <div class="modal-header">
        <h5 class="modal-title" id="confirmDeleteLabel">Confirm Deletion</h5>
        <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
      </div>
      <div class="modal-body">
        Are you sure you want to delete this {{ verbose_name }}?
      </div>
      <div class="modal-footer">
        <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cancel</button>
        <form id="confirmDeleteForm" method="post" style="display:inline;">
          {% csrf_token %}
          <button type="submit" class="btn btn-danger">Delete</button>
        </form>
      </div>
    </div>
  </div>
</div>

{% endblock %}

{% block extra_css %}
<style>
  .edit-link, .delete-link {
    color: var(--bs-primary);
    opacity: 0;
    transition: opacity 0.2s;
    text-decoration: none;
  }
  .row-link {
    color: black;
    text-decoration: none;
  }
  tr:hover .edit-link,
  tr:hover .delete-link {
    opacity: 1;
  }
  tr:hover .row-link {
    text-decoration: underline;
    opacity: 1;
  }
  .pagination {
  justify-content: center;
  margin-top: 1rem;
}

.page-item {
  margin: 0 0.25rem;
}

.page-link {
  color: var(--bs-primary);
  border-radius: 0.4rem;
  border: 1px solid #dee2e6;
  background-color: #fff;
  transition: background 0.2s, color 0.2s;
}

.page-link:hover, .page-item.active .page-link {
  background-color: var(--bs-primary);
  color: #fff;
  border-color: var(--bs-primary);
}
</style>
{% endblock extra_css %}

{% block extra_js %}
<script>
  var confirmDeleteModal = document.getElementById('confirmDeleteModal');
  confirmDeleteModal.addEventListener('show.bs.modal', function (event) {
    var button = event.relatedTarget;
    var deleteUrl = button.getAttribute('data-delete-url');
    var form = document.getElementById('confirmDeleteForm');
    form.setAttribute('action', deleteUrl);
  });
</script>
<script>
  document.addEventListener('DOMContentLoaded', function () {
    setTimeout(function () {
      document.querySelectorAll('.alert-success').forEach(function (alert) {
        var bsAlert = bootstrap.Alert.getOrCreateInstance(alert);
        bsAlert.close();
      });
    }, 3000);
  });
</script>
{% endblock extra_js %}






